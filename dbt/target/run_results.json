{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.9", "generated_at": "2025-04-24T07:52:52.113455Z", "invocation_id": "5ce8ded3-96eb-495c-bb39-2c3962d99fbc", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.508734Z", "completed_at": "2025-04-24T07:52:50.552790Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.556611Z", "completed_at": "2025-04-24T07:52:50.556628Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.051282644271850586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics._hospital_medicines", "compiled": true, "compiled_code": "\n\nSELECT \n  medicine_id,\n  name,\n  category,\n  manufacturer,\n  SAFE_CAST(price AS NUMERIC) AS price \nFROM `dataeng-2025-gar`.`hospital`.`medicines`", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.560854Z", "completed_at": "2025-04-24T07:52:50.628868Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.630712Z", "completed_at": "2025-04-24T07:52:50.630724Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.09390950202941895, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics._hospital_patients", "compiled": true, "compiled_code": "\n\nSELECT \n  patient_id,\n  full_name,\n  date_of_birth,\n  gender,\n  blood_type,\n  contact_info,\n  insurance_id,\n  -- Hitung usia\n  DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) AS age,\n  \n  -- Age group calculation\n  CASE\n    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) < 18 THEN 'Child'\n    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 18 AND 40 THEN 'Adult'\n    WHEN DATE_DIFF(CURRENT_DATE(), PARSE_DATE('%Y%m%d', CAST(date_of_birth AS STRING)), YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'\n    ELSE 'Senior'\n  END AS age_group\nFROM `dataeng-2025-gar`.`hospital`.`patients`", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.573657Z", "completed_at": "2025-04-24T07:52:50.631106Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.638182Z", "completed_at": "2025-04-24T07:52:50.638198Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.07457113265991211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.doctors", "compiled": true, "compiled_code": "\n\nSELECT\n  doctor_id,\n  name AS doctor_name,\n  specialization,\n  experience_years,\n  contact_info,\n  -- Add some derived fields\n  CASE\n    WHEN experience_years < 5 THEN 'Junior'\n    WHEN experience_years BETWEEN 5 AND 15 THEN 'Experienced'\n    ELSE 'Senior'\n  END AS experience_level\nFROM `dataeng-2025-gar`.`hospital`.`doctors`", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`doctors`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.568746Z", "completed_at": "2025-04-24T07:52:50.629411Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.631402Z", "completed_at": "2025-04-24T07:52:50.631412Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.08234071731567383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics._hospital_visits", "compiled": true, "compiled_code": "\n\nSELECT * FROM `dataeng-2025-gar`.`hospital`.`visits`", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`_hospital_visits`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.632083Z", "completed_at": "2025-04-24T07:52:50.639196Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.640065Z", "completed_at": "2025-04-24T07:52:50.640076Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.02287745475769043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.medicines", "compiled": true, "compiled_code": "\n\nSELECT\n  medicine_id,\n  name AS medicine_name,\n  category,\n  manufacturer,\n  -- Perbaikan: Konversi ke numeric\n  SAFE_CAST(price AS NUMERIC) AS price,\n  -- Perbaikan price category dengan tipe data yang benar\n  CASE\n    WHEN SAFE_CAST(price AS NUMERIC) < 10 THEN 'Low-cost'\n    WHEN SAFE_CAST(price AS NUMERIC) BETWEEN 10 AND 50 THEN 'Medium-cost'\n    ELSE 'High-cost'\n  END AS price_category\nFROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_medicines`", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`medicines`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.723113Z", "completed_at": "2025-04-24T07:52:50.754844Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.756153Z", "completed_at": "2025-04-24T07:52:50.756161Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.06386470794677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.patients", "compiled": true, "compiled_code": "\n\nWITH cleaned_patients AS (\n  SELECT\n    patient_id,\n    full_name,\n    date_of_birth,\n    gender,\n    blood_type,\n    contact_info,\n    insurance_id\n  FROM `dataeng-2025-gar`.`hospital_staging`.`_hospital_patients`\n)\n\nSELECT\n  patient_id,\n  full_name,\n  date_of_birth,\n  gender,\n  blood_type,\n  contact_info,\n  insurance_id,\n  -- Hitung usia\n  CASE\n    WHEN date_of_birth IS NOT NULL \n    THEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR)\n    ELSE NULL\n  END AS age,\n  -- Kategori usia\n  CASE\n    WHEN date_of_birth IS NULL THEN 'Invalid Birth Date'\n    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) < 18 THEN 'Child'\n    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 18 AND 40 THEN 'Adult'\n    WHEN DATE_DIFF(CURRENT_DATE(), date_of_birth, YEAR) BETWEEN 41 AND 65 THEN 'Middle-aged'\n    ELSE 'Senior'\n  END AS age_group\nFROM cleaned_patients", "relation_name": "`dataeng-2025-gar`.`hospital_staging`.`patients`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.802000Z", "completed_at": "2025-04-24T07:52:50.943265Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.957008Z", "completed_at": "2025-04-24T07:52:50.957023Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2484874725341797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_doctors_doctor_id.0f5d54ded9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect doctor_id\nfrom `dataeng-2025-gar`.`hospital_staging`.`doctors`\nwhere doctor_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.859709Z", "completed_at": "2025-04-24T07:52:50.937404Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.944160Z", "completed_at": "2025-04-24T07:52:50.944174Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.18510150909423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_doctors_doctor_name.b0d2559061", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect doctor_name\nfrom `dataeng-2025-gar`.`hospital_staging`.`doctors`\nwhere doctor_name is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.925021Z", "completed_at": "2025-04-24T07:52:50.939812Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.947434Z", "completed_at": "2025-04-24T07:52:50.947448Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.22012543678283691, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_doctors_experience_years.f354663d1a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect experience_years\nfrom `dataeng-2025-gar`.`hospital_staging`.`doctors`\nwhere experience_years is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:50.930521Z", "completed_at": "2025-04-24T07:52:50.945467Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:50.982248Z", "completed_at": "2025-04-24T07:52:50.982264Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.23882293701171875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.unique_doctors_doctor_id.c207617ce7", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select doctor_id as unique_field\n  from `dataeng-2025-gar`.`hospital_staging`.`doctors`\n  where doctor_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.178085Z", "completed_at": "2025-04-24T07:52:51.273032Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.273434Z", "completed_at": "2025-04-24T07:52:51.273444Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1981821060180664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_patients_full_name.7bac40f23c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect full_name\nfrom `dataeng-2025-gar`.`hospital_staging`.`patients`\nwhere full_name is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.140043Z", "completed_at": "2025-04-24T07:52:51.352238Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.365887Z", "completed_at": "2025-04-24T07:52:51.365896Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.2730979919433594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.visits_enhanced", "compiled": true, "compiled_code": "\n\nSELECT\n  v.visit_id,\n  v.visit_date,\n  v.diagnosis,\n  v.total_cost,\n  p.patient_id,\n  p.full_name,\n  p.age,\n  p.age_group,\n  p.gender,\n  p.blood_type,\n  d.doctor_id,\n  d.doctor_name,\n  d.specialization,\n  d.experience_level,\n  -- Add some derived metrics\n  CASE\n    WHEN v.total_cost > 500 THEN 'High-cost visit'\n    WHEN v.total_cost > 200 THEN 'Medium-cost visit'\n    ELSE 'Low-cost visit'\n  END AS cost_category,\n  EXTRACT(MONTH FROM v.visit_date) AS visit_month,\n  EXTRACT(YEAR FROM v.visit_date) AS visit_year\nFROM `dataeng-2025-gar`.`hospital`.`visits` v\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON v.patient_id = p.patient_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON v.doctor_id = d.doctor_id", "relation_name": "`dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.246064Z", "completed_at": "2025-04-24T07:52:51.347874Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.383298Z", "completed_at": "2025-04-24T07:52:51.383311Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2944207191467285, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.prescriptions_enhanced", "compiled": true, "compiled_code": "\n\nSELECT\n  pr.prescription_id,\n  pr.dosage,\n  pr.duration,\n  p.patient_id,\n  p.full_name,\n  p.age_group,\n  p.gender,\n  d.doctor_id,\n  d.doctor_name,\n  d.specialization,\n  m.medicine_id,\n  m.medicine_name,\n  m.category AS medicine_category,\n  m.price,\n  m.price_category,\n  -- Calculate estimated total cost\n  CASE\n    WHEN SPLIT(pr.duration, ' ')[1] = 'days' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * m.price\n    WHEN SPLIT(pr.duration, ' ')[1] = 'weeks' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 7 * m.price\n    WHEN SPLIT(pr.duration, ' ')[1] = 'months' THEN CAST(SPLIT(pr.duration, ' ')[0] AS INT) * 30 * m.price\n    ELSE m.price\n  END AS estimated_total_cost\nFROM `dataeng-2025-gar`.`hospital`.`prescriptions` pr\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON pr.patient_id = p.patient_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`doctors` d ON pr.doctor_id = d.doctor_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`medicines` m ON pr.medicine_id = m.medicine_id", "relation_name": "`dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.225474Z", "completed_at": "2025-04-24T07:52:51.389324Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.393541Z", "completed_at": "2025-04-24T07:52:51.393549Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.29235029220581055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_patients_age.8fed007e09", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect age\nfrom `dataeng-2025-gar`.`hospital_staging`.`patients`\nwhere age is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.399002Z", "completed_at": "2025-04-24T07:52:51.422678Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.434954Z", "completed_at": "2025-04-24T07:52:51.434970Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.04490852355957031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.unique_patients_patient_id.8d0f9eb60a", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select patient_id as unique_field\n  from `dataeng-2025-gar`.`hospital_staging`.`patients`\n  where patient_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.411806Z", "completed_at": "2025-04-24T07:52:51.421560Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.425163Z", "completed_at": "2025-04-24T07:52:51.425178Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06923675537109375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_patients_patient_id.330c5fb3d9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect patient_id\nfrom `dataeng-2025-gar`.`hospital_staging`.`patients`\nwhere patient_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.416347Z", "completed_at": "2025-04-24T07:52:51.423832Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.436439Z", "completed_at": "2025-04-24T07:52:51.436449Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.11547303199768066, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.billing_enhanced", "compiled": true, "compiled_code": "\n\nSELECT\n  b.billing_id,\n  b.billing_date,\n  b.total_amount,\n  b.payment_status,\n  v.visit_id,\n  v.visit_date,\n  v.diagnosis,\n  v.doctor_name,\n  v.specialization,\n  p.patient_id,\n  p.full_name,\n  p.age_group,\n  p.insurance_id,\n  -- Add some derived fields\n  EXTRACT(MONTH FROM b.billing_date) AS billing_month,\n  EXTRACT(YEAR FROM b.billing_date) AS billing_year,\n  CASE\n    WHEN b.payment_status = 'Paid' THEN 1\n    ELSE 0\n  END AS is_paid,\n  -- Days between visit and billing\n  DATE_DIFF(b.billing_date, v.visit_date, DAY) AS days_to_bill\nFROM `dataeng-2025-gar`.`hospital`.`billing_payments` b\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON b.visit_id = v.visit_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_staging`.`patients` p ON b.patient_id = p.patient_id", "relation_name": "`dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.508476Z", "completed_at": "2025-04-24T07:52:51.606056Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.680706Z", "completed_at": "2025-04-24T07:52:51.680717Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.32210302352905273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.monthly_visit_stats", "compiled": true, "compiled_code": "\n\nSELECT\n  visit_year,\n  visit_month,\n  COUNT(DISTINCT visit_id) AS total_visits,\n  COUNT(DISTINCT patient_id) AS unique_patients,\n  COUNT(DISTINCT doctor_id) AS unique_doctors,\n  SUM(total_cost) AS total_revenue,\n  AVG(total_cost) AS avg_visit_cost,\n  -- Calculate percentage of high-cost visits\n  SAFE_DIVIDE(\n    COUNT(CASE WHEN cost_category = 'High-cost visit' THEN 1 END),\n    COUNT(*)\n  ) * 100 AS pct_high_cost_visits\nFROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`\nGROUP BY visit_year, visit_month\nORDER BY visit_year, visit_month", "relation_name": "`dataeng-2025-gar`.`hospital_analytics`.`monthly_visit_stats`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.565291Z", "completed_at": "2025-04-24T07:52:51.623143Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.681118Z", "completed_at": "2025-04-24T07:52:51.681127Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.23203682899475098, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_visits_enhanced_total_cost.dbc56e173b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect total_cost\nfrom `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`\nwhere total_cost is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.632646Z", "completed_at": "2025-04-24T07:52:51.694465Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.806067Z", "completed_at": "2025-04-24T07:52:51.806083Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.306929349899292, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.not_null_visits_enhanced_visit_id.7d9d89114c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect visit_id\nfrom `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`\nwhere visit_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.654874Z", "completed_at": "2025-04-24T07:52:51.681963Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.748596Z", "completed_at": "2025-04-24T07:52:51.748612Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.27040982246398926, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.hospital_analytics.unique_visits_enhanced_visit_id.6a5084d297", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select visit_id as unique_field\n  from `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced`\n  where visit_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.916042Z", "completed_at": "2025-04-24T07:52:51.987748Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:51.991423Z", "completed_at": "2025-04-24T07:52:51.991432Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.20949745178222656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.doctor_performance", "compiled": true, "compiled_code": "\n\nSELECT\n  d.doctor_id,\n  d.doctor_name,\n  d.specialization,\n  d.experience_level,\n  COUNT(DISTINCT v.visit_id) AS total_visits,\n  COUNT(DISTINCT v.patient_id) AS unique_patients,\n  SUM(v.total_cost) AS total_revenue_generated,\n  AVG(v.total_cost) AS avg_visit_cost,\n  -- Prescription metrics\n  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,\n  SUM(pr.estimated_total_cost) AS total_prescription_value\nFROM `dataeng-2025-gar`.`hospital_staging`.`doctors` d\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON d.doctor_id = v.doctor_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON d.doctor_id = pr.doctor_id\nGROUP BY 1, 2, 3, 4\nORDER BY total_revenue_generated DESC", "relation_name": "`dataeng-2025-gar`.`hospital_analytics`.`doctor_performance`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:51.999410Z", "completed_at": "2025-04-24T07:52:52.057317Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:52.060976Z", "completed_at": "2025-04-24T07:52:52.060983Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.08272862434387207, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.patient_journey", "compiled": true, "compiled_code": "\n\nWITH patient_data AS (\n  SELECT \n    patient_id,\n    full_name,\n    gender,\n    age\n  FROM `dataeng-2025-gar`.`hospital_staging`.`patients`\n),\n\nvisit_details AS (\n  SELECT\n    v.visit_id,\n    v.visit_date,\n    v.patient_id,\n    COALESCE(p.full_name, 'Unknown Patient') AS patient_full_name,\n    v.doctor_id,\n    v.doctor_name,\n    v.specialization,\n    v.diagnosis,\n    v.total_cost AS visit_cost,\n    v.cost_category,\n    p.gender,\n    p.age\n  FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v\n  LEFT JOIN patient_data p ON v.patient_id = p.patient_id\n),\n\nprescription_details AS (\n  SELECT\n    p.prescription_id,\n    p.patient_id,\n    p.doctor_id,\n    p.medicine_name,\n    p.dosage,\n    p.duration,\n    p.estimated_total_cost AS prescription_cost,\n    -- Using visit_date as proxy since prescription_date doesn't exist\n    (SELECT MIN(v.visit_date) \n    FROM `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v\n    WHERE v.patient_id = p.patient_id\n      AND v.doctor_id = p.doctor_id\n    ) AS approximate_prescription_date\n  FROM `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` p\n),\n\nbilling_details AS (\n  SELECT\n    b.billing_id,\n    b.visit_id,\n    b.patient_id,\n    b.billing_date,\n    b.total_amount,\n    b.payment_status,\n    b.days_to_bill\n  FROM `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b\n)\n\nSELECT\n  vd.visit_id,\n  vd.visit_date,\n  vd.patient_id,\n  vd.patient_full_name AS patient_name,\n  vd.gender,\n  vd.age,\n  vd.doctor_id,\n  COALESCE(vd.doctor_name, 'Unknown Doctor') AS doctor_name,\n  COALESCE(vd.specialization, 'Not Specified') AS specialization,\n  COALESCE(vd.diagnosis, 'No Diagnosis Recorded') AS diagnosis,\n  vd.visit_cost,\n  vd.cost_category,\n  \n  pd.prescription_id,\n  COALESCE(pd.medicine_name, 'No Prescription') AS medicine_name,\n  pd.dosage,\n  pd.duration,\n  COALESCE(pd.prescription_cost, 0) AS prescription_cost,\n  \n  bd.billing_id,\n  bd.billing_date,\n  bd.total_amount AS billed_amount,\n  COALESCE(bd.payment_status, 'Not Billed') AS payment_status,\n  bd.days_to_bill,\n  \n  -- Financial calculations\n  vd.visit_cost + COALESCE(pd.prescription_cost, 0) AS total_episode_cost,\n  CASE\n    WHEN bd.payment_status = 'Paid' THEN 0\n    ELSE COALESCE(bd.total_amount, vd.visit_cost)\n  END AS outstanding_balance,\n  \n  -- Enhanced analytics\n  CASE\n    WHEN pd.prescription_id IS NOT NULL THEN 1\n    ELSE 0\n  END AS has_prescription,\n  \n  COUNT(pd.prescription_id) OVER (\n    PARTITION BY vd.patient_id\n  ) AS total_prescriptions_for_patient,\n  \n  AVG(vd.visit_cost) OVER (\n    PARTITION BY vd.patient_id\n  ) AS avg_visit_cost_per_patient,\n  \n  -- Visit analytics\n  COUNT(vd.visit_id) OVER (\n    PARTITION BY vd.patient_id\n  ) AS total_visits_for_patient\n\nFROM visit_details vd\nLEFT JOIN prescription_details pd ON \n  vd.patient_id = pd.patient_id AND\n  vd.doctor_id = pd.doctor_id\nLEFT JOIN billing_details bd ON \n  vd.visit_id = bd.visit_id\nORDER BY \n  vd.patient_full_name,\n  vd.visit_date", "relation_name": "`dataeng-2025-gar`.`hospital_analytics`.`patient_journey`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-24T07:52:52.041857Z", "completed_at": "2025-04-24T07:52:52.079971Z"}, {"name": "execute", "started_at": "2025-04-24T07:52:52.080402Z", "completed_at": "2025-04-24T07:52:52.080409Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.08841085433959961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.hospital_analytics.patient_spending_analysis", "compiled": true, "compiled_code": "\n\nSELECT\n  p.patient_id,\n  p.full_name,\n  p.age_group,\n  p.gender,\n  p.blood_type,\n  COUNT(DISTINCT v.visit_id) AS total_visits,\n  SUM(v.total_cost) AS total_medical_spend,\n  AVG(v.total_cost) AS avg_visit_cost,\n  COUNT(DISTINCT pr.prescription_id) AS total_prescriptions,\n  SUM(pr.estimated_total_cost) AS total_prescription_spend,\n  COUNT(DISTINCT b.billing_id) AS total_bills,\n  SUM(CASE WHEN b.payment_status = 'Paid' THEN b.total_amount ELSE 0 END) AS total_paid,\n  SUM(CASE WHEN b.payment_status != 'Paid' THEN b.total_amount ELSE 0 END) AS total_outstanding\nFROM `dataeng-2025-gar`.`hospital_staging`.`patients` p\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`visits_enhanced` v ON p.patient_id = v.patient_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`prescriptions_enhanced` pr ON p.patient_id = pr.patient_id\nLEFT JOIN `dataeng-2025-gar`.`hospital_intermediate`.`billing_enhanced` b ON p.patient_id = b.patient_id\nGROUP BY 1, 2, 3, 4, 5\nORDER BY total_medical_spend DESC", "relation_name": "`dataeng-2025-gar`.`hospital_analytics`.`patient_spending_analysis`"}], "elapsed_time": 3.085355520248413, "args": {"project_dir": "/usr/app/dbt", "quiet": false, "enable_legacy_logger": false, "partial_parse_file_diff": true, "log_format_file": "debug", "static_parser": true, "log_path": "/usr/app/dbt/logs", "require_resource_names_without_spaces": false, "vars": {}, "profiles_dir": "/usr/app/dbt", "write_json": true, "warn_error_options": {"include": [], "exclude": []}, "source_freshness_run_project_hooks": false, "use_colors_file": true, "show_resource_report": false, "indirect_selection": "eager", "partial_parse": true, "populate_cache": true, "empty_catalog": false, "use_colors": true, "compile": true, "defer": false, "introspect": true, "log_format": "default", "version_check": true, "macro_debugging": false, "favor_state": false, "send_anonymous_usage_stats": true, "require_explicit_package_overrides_for_builtin_materializations": true, "strict_mode": false, "invocation_command": "dbt docs generate", "print": true, "cache_selected_only": false, "log_level": "info", "log_level_file": "debug", "select": [], "exclude": [], "static": false, "printer_width": 80, "log_file_max_bytes": 10485760, "which": "generate"}}